###########################################
#
# Integration Instantiated in yaml
#
###########################################
#
# Added MagicHome LEDs
# This is a third-party custom component on flux_led
# instead of the official one from HA
#light magic_home:
#   - platform: flux_led
#     devices:
#       192.168.1.xx:
#         name: Guest Room Bed LED
#         mode: "rgb"

###########################################
#
# Custom Entities
#
###########################################
# Custom Thermostat
#climate:
#  - platform: generic_thermostat
#    name: Guest Room Thermostat
#    heater: input_boolean.guest_room_valve_switch
#    target_sensor: sensor.guest_room_temperature_sensor
#    precision: 0.5
#    min_temp: 10
#    max_temp: 25
#    cold_tolerance: 0.1
#    hot_tolerance: 0.1
#    initial_hvac_mode: "heat"
#
## Room Motion
#group:
#  guest_room_entrance_motion:
#    name: Guest Room Entrance Motion
#    entities:
#      - binary_sensor.guest_room_door_motion_sensor_motion
#
#  guest_room_appliances:
#    name: Guest Room Appliances
#    entities:
#      - climate.guest_room
#      - light.guest_room_ceiling_light
#
## Custom Variables
#input_boolean:
#  # Spare Room Usage
#  guest_room_guests_use_this_room:
#    name: "Guest Room Guests Use This Room"
#
#  # Custom Thermostat Switch
#  guest_room_valve_switch:
#    name: "Guest Room Valve Switch"
#
#  # First Time Presence in a Room
#  guest_room_short_presence: # done
#    name: "Guest Room Short Presence"
#    initial: "off"
#
###############################################
#
# Scripts
#
###############################################
#script:
#  guest_room_all_lights_turn_on:
#    alias: Guest Room All Lights Turn On
#    mode: parallel
#    max: 100
#    sequence:
#      - service: light.turn_on
#        entity_id:
#          - light.guest_room_ceiling_light
#
#  guest_room_all_lights_turn_off:
#    alias: Guest Room All Lights Turn Off
#    mode: parallel
#    max: 100
#    sequence:
#      #- service: switch.turn_off
#      #  entity_id:
#      #    - switch.guest_room_screen_led
#      - service: light.turn_off
#        entity_id:
#          #    - light.guest_room_lamps
#          - light.guest_room_ceiling_light
#
#  guest_room_set_heating_temp_with_state_maintaince:
#    alias: Guest Room Set Heating Temperature With State Maintaince
#    mode: restart
#    sequence:
#      # Clear flags
#      - service: input_boolean.turn_off
#        entity_id: input_boolean.guest_room_short_presence
#      # Turn on Heating
#      - data:
#          hvac_mode: heat
#        entity_id: climate.guest_room
#        service: climate.set_hvac_mode
#      - data:
#          temperature: 22
#        entity_id: climate.guest_room
#        service: climate.set_temperature
#      - data:
#          stop_actions: false
#        entity_id: automation.guest_room_heating_on_if_people_present
#        service: automation.turn_off
#
###############################################
#
# Automations:
# En-suite Room
# - Lighting/Heating automation based on motion sensors
# - Actions based on buttons
# - Maintaince on bedroom automation based on presence
#
###############################################
automation:
#  ###############################################
#  # Heating Automation based on motion sensors
#  ###############################################
#  - alias: HL-GR Guest Room Heating Off If No Person For 10 Min
#    id: "1599910386222"
#    trigger:
#      - entity_id: group.guest_room_motion
#        platform: state
#        from: "on"
#        to: "off"
#        for: 00:10:00
#      - minutes: /5
#        platform: time_pattern
#    condition:
#      - condition: state
#        entity_id: group.guest_room_motion
#        for: 00:10:00
#        state: "off"    
#    action:
#      # Turn Off Lighting
#      - service: script.guest_room_all_lights_turn_off
#      - service: automation.turn_on
#        entity_id: automation.guest_room_lights_on_if_people_present
#


#  ###############################################
#  # Lighting Automation based on motion sensors
#  ###############################################
#  - alias: L-GR Guest Room Ceiling Lights On If People Present
#    id: "1599910376296"
#    description: "automation.guest_room_lights_on_if_people_present"
#    trigger:
#      - entity_id: group.guest_room_motion
#        platform: state
#        from: "off"
#        to: "on"
#    condition:
#      - condition: or
#        conditions:
#          - condition: and
#            conditions:
#              - entity_id: binary_sensor.guest_room_door_motion_sensor_motion
#                condition: state
#                state: "on"
#              - entity_id: sensor.guest_room_door_motion_sensor_light
#                condition: numeric_state
#                below: "30"
#          - condition: and
#            conditions:
#              - entity_id: binary_sensor.guest_room_bed_motion_sensor_motion
#                condition: state
#                state: "on"
#              - entity_id: binary_sensor.guest_room_bed_motion_sensor_light
#                condition: numeric_state
#                below: "30"
#    action:
#      - service: light.turn_on
#        entity_id: light.guest_room_ceiling_light
#      - service: automation.turn_off
#        entity_id: automation.guest_room_lights_on_if_people_present
#
#  ###############################################
#  # Lighting Automation based on buttons
#  ###############################################
#  - alias: B-GR Guest Room Wall Switch - Single Press - Toggle Ceiling Light
#    trigger:
#      - platform: state
#        entity_id: sensor.guest_room_ceiling_light_wall_switch
#        to: single
#    action:
#      - choose:
#          # IF - all lights off - turn on ceiling light
#          - conditions:
#              - condition: and
#                conditions:
#                  - condition: state
#                    entity_id: light.guest_room_ceiling_light
#                    state: "off"
#            sequence:
#              - service: light.turn_on
#                entity_id: light.guest_room_ceiling_light
#        # ELSE - some lights on - turn off all lights
#        default:
#          - service: light.turn_off
#            entity_id:
#              - light.guest_room_ceiling_light
#
  #- alias: B-GR Guest Room Button Single Press - Toggle Ceiling Lights
  #  trigger:
  #    - platform: state
  #      entity_id: sensor.guest_room_button
  #      to: single
  #  action:
  #    - service: light.toggle
  #      entity_id: light.guest_room_ceiling_light

  ######################################################
  # Maintaince on bedroom automation based on presence
  ######################################################
#  - alias: P-GR Guest Room Disable The Entering Room Automation If People Present
#    trigger:
#      - entity_id: binary_sensor.guest_room_door_motion_sensor_motion
#        platform: state
#        from: "off"
#        to: "on"
#      - entity_id: binary_sensor.guest_room_bed_motion_sensor_motion
#        platform: state
#        from: "off"
#        to: "on"
#    action:
#      - delay: 00:00:30
#      - service: automation.turn_off
#        entity_id:
#          - automation.guest_room_lights_on_if_people_present
#      - delay: 00:03:30
#      # Short presence machanism requires to turn off auto-heating late
#      - service: automation.turn_off
#        entity_id:
#          - automation.guest_room_heating_on_if_people_present
