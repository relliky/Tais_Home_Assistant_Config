script general_tv:

  fire_tv_starts_app:
    alias: Fire TV Starts App
    fields:
      room:
        example: "master_room, kitchen, living_room"
      app:
        example: "bilibili, youtube, plex, netflix"
    sequence:
      - condition: template
        value_template: >   
          {% set room_tv_entity = 'media_player.' + room + '_tv' %}
          {{ state(room_tv_entity) == 'on' }}      
      - service: media_player.select_source
        target:
          entity_id: >
            media_player.{{room}}_fire_tv
        data:
          source: >
            {% if   app == 'bilibili' %}
              com.bilibili.tv
            {% elif app == 'youtube'  %}
              com.amazon.firetv.youtube
            {% elif app == 'plex'     %}
              com.plexapp.android
            {% elif app == 'netflix'  %}
              com.netflix.ninja   
            {% endif %}            
      # TV is switched to Fire TV      
      - service: media_player.select_source
        target:
          entity_id: >
            media_player.{{room}}_tv
        data:
          source: >
            {% if room == 'master_room' %}
              Amazon Fire TV Cube          
            {% else %}
              Amazon Fire TV Stick
            {% endif %}        